#%Module###<-magic cookie ####################################################
##
##   CMBENV tools.
##
##
# variables for Tcl script use only
set     version  @VERSION@

module-whatis "Loads CMB software tools."

proc ModulesHelp { } {
  global version
  puts stderr "\t\t CMB software tools - Version $version\n"
  puts stderr "\t This loads a python stack and other compiled software"
  puts stderr "\t packages useful for CMB data analysis."
  puts stderr ""
}

conflict cmbenv

@modload@

# altd is evil and causes random job hangs
if [ is-loaded altd ] {
  module unload altd
}

# darshan is useless at best and may cause overhead
if [ is-loaded darshan ] {
  module unload darshan
}

# This is set by OS python and gives us problems.
unsetenv PYTHONSTARTUP

# Disable prompt change
setenv VIRTUAL_ENV_DISABLE_PROMPT 1

# This is the python environment location
if { [module-info mode load] || [module-info mode switch2] } {
    puts stdout "source @PYTHON_PREFIX@/cmbload.sh;"
} elseif { [module-info mode remove] && ![module-info mode switch3] } {
    puts stdout "source @PYTHON_PREFIX@/cmbunload.sh;"
}

# This is the location of the extra compiled software
setenv CMBENV_AUX_ROOT "@AUX_PREFIX@"
prepend-path CMAKE_PREFIX_PATH "@AUX_PREFIX@"
prepend-path PATH "@AUX_PREFIX@/bin"
prepend-path CPATH "@AUX_PREFIX@/include"
prepend-path LD_LIBRARY_PATH "@AUX_PREFIX@/lib"
prepend-path LIBRARY_PATH "@AUX_PREFIX@/lib"
prepend-path PYTHONPATH "@AUX_PREFIX@/lib/python@PYVERSION@/site-packages"
prepend-path PKG_CONFIG_PATH "@AUX_PREFIX@/lib/pkgconfig"

# The NERSC "sqs" command is a python script with a hard-coded
# interpreter that is incompatible.
set-alias "sqs" "python /usr/common/software/bin/sqs"
